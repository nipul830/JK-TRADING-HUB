<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>JK Trading Hub</title>
  <link rel="icon" href="icon.png"/>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>

  <!-- ===== NAVBAR (fixed) ===== -->
  <header class="navbar">
    <div class="brand">
      <img src="icon.png" alt="logo"/>
      <span>JK Trading Hub</span>
    </div>
    <nav class="tabs" id="tabs">
      <a data-page="home"     href="#home">Home</a>
      <a data-page="market"   href="#market">Market</a>
      <a data-page="trade"    href="#trade">Trade</a>
      <a data-page="discover" href="#discover">Discover</a>
      <a data-page="account"  href="#account">My Account</a>
      <div class="underline"></div>
    </nav>
  </header>

  <main>
    <!-- ===== HOME ===== -->
    <section id="home" class="page active">
      <div class="card">
        <h2>JK ALGO Setup</h2>
        <div class="grid-2">
          <label class="f"><span>Pair</span>
            <select id="pairSel">
              <option value="BTCUSDT">BTC/USDT</option>
              <option value="ETHUSDT">ETH/USDT</option>
              <option value="SOLUSDT">SOL/USDT</option>
              <option value="XRPUSDT">XRP/USDT</option>
            </select>
          </label>
          <label class="f"><span>Timeframe</span>
            <select id="tfSel">
              <option>1m</option><option selected>5m</option>
              <option>15m</option><option>1h</option><option>4h</option>
            </select>
          </label>
        </div>

        <div class="grid-2">
          <label class="f"><span>Risk per Trade (%)</span><input id="riskPct" placeholder="e.g. 1.0"/></label>
          <label class="f"><span>Position Size (USDT)</span><input id="posUSDT" placeholder="e.g. 100"/></label>
        </div>

        <div class="seg">
          <button id="btnStart">Start</button>
          <button id="btnStop" class="danger">Stop</button>
        </div>

        <p class="small mute">Frontend‑only UI. Settings <b>localStorage</b> में सेव रहते हैं. वास्तविक order execute नहीं होते.</p>
      </div>

      <div class="card">
        <h2>Strategy &amp; Indicators</h2>
        <label class="f"><span>Pine‑like Strategy (paste code)</span>
          <textarea id="pineBox" rows="4">//@version=5
indicator('JK Demo', overlay=true)
emaFast = ta.ema(close, 20)
plot(emaFast)</textarea>
        </label>

        <div class="grid-3">
          <input id="indName" placeholder="e.g. EMA"/>
          <input id="indParam" placeholder="e.g. length=20"/>
          <button id="btnAddInd">Add</button>
        </div>

        <ul id="chipList" class="chip-list"></ul>

        <div class="seg">
          <button id="btnSaveStrat">Save Strategy</button>
          <button id="btnExport">Export JSON</button>
          <label class="btn-file">
            <input type="file" id="fileImport" accept=".json"/> Import JSON
          </label>
        </div>
      </div>

      <div class="card">
        <h2>API Keys</h2>
        <div class="grid-3">
          <label class="f"><span>Exchange</span>
            <select id="exSel"><option>Binance</option></select>
          </label>
          <label class="f"><span>API Key</span><input id="apiKey" placeholder="xxxxxxxx"/></label>
          <label class="f pw"><span>API Secret</span><input id="apiSec" type="password" placeholder="********"/><button id="pwShow">Show</button></label>
        </div>
        <button id="btnSaveKeys">Save Keys (local)</button>
        <p class="small mute">Keys केवल आपके ब्राउजर के <b>localStorage</b> में सुरक्षित हैं; server पर नहीं भेजे जाते.</p>
      </div>
    </section>

    <!-- ===== MARKET (TV chart placeholder) ===== -->
    <section id="market" class="page">
      <div class="card">
        <h2>Market</h2>
        <div class="grid-2">
          <label class="f"><span>Pair</span>
            <select id="mPair">
              <option>BTC/USDT</option>
              <option selected>ETH/USDT</option>
              <option>SOL/USDT</option>
              <option>XRP/USDT</option>
            </select>
          </label>
          <div class="seg">
            <button data-tf="1m">1m</button>
            <button class="active" data-tf="5m">5m</button>
            <button data-tf="15m">15m</button>
            <button data-tf="1h">1h</button>
            <button data-tf="4h">4h</button>
          </div>
        </div>

        <div class="tv-wrap">
          <div id="tv" class="tv-chart"></div>
          <div class="tv-bottom-blank"></div>
        </div>
        <p class="small">Note: compact mode — top toolbar &amp; left tools hidden for clean view.</p>
      </div>
    </section>

    <!-- ===== TRADE ===== -->
    <section id="trade" class="page">
      <div class="card"><h2>Trade</h2><p class="small">Yahan pe tum apna trading UI add kar sakte ho.</p></div>
    </section>

    <!-- ===== DISCOVER (NEWS) ===== -->
    <section id="discover" class="page">
      <div class="card">
        <div class="card-head">
          <h2>Market News</h2>
          <div class="seg" id="newsFilters">
            <button class="active" data-cat="all">All</button>
            <button data-cat="crypto">Crypto</button>
            <button data-cat="commodity:gold">Gold</button>
            <button data-cat="commodity:crude">Crude</button>
            <button data-cat="forex">Forex</button>
            <button data-cat="indices">Indices</button>
          </div>
        </div>
        <div class="right small"><button id="newsRefresh" class="btn">Refresh</button></div>
        <div id="newsList" class="news-list"></div>
      </div>
    </section>

    <!-- ===== ACCOUNT ===== -->
    <section id="account" class="page">
      <div class="card"><h2>My Account</h2><p class="small">Signup में दी गई details yahan दिखा सकते हैं.</p></div>
    </section>
  </main>

  <!-- ===== SCRIPTS ===== -->
  <script src="https://s3.tradingview.com/tv.js"></script>
  <script>
  // ===== Router (tabs) =====
  const pages = [...document.querySelectorAll('.page')];
  const links = [...document.querySelectorAll('.tabs a')];
  const underline = document.querySelector('.tabs .underline');

  function activate(tab){
    links.forEach(a=>a.classList.toggle('active', a.dataset.page===tab));
    pages.forEach(p=>p.classList.toggle('active', p.id===tab));
    const el = links.find(a=>a.dataset.page===tab) || links[0];
    const r = el.getBoundingClientRect();
    const pr = el.parentElement.getBoundingClientRect();
    underline.style.width = r.width+'px';
    underline.style.transform = `translateX(${r.left-pr.left}px)`;
    localStorage.setItem('jk_tab', tab);
    if(tab==='market') mountTV(); // ensure chart exists
  }

  function onHash(){
    const tab = (location.hash||'#home').replace('#','');
    activate(tab);
  }
  window.addEventListener('hashchange', onHash);
  window.addEventListener('load', ()=>{
    const saved = localStorage.getItem('jk_tab');
    location.hash = '#'+(saved || 'home');
    onHash();
  });

  // ===== TradingView minimal embed (compact) =====
  let tvWidget;
  function symbolMap(txt){
    return (txt||'BTC/USDT').replace('/','USDT')+'T:BINANCE';
  }
  function tfMap(t){ return t; }

  function mountTV(){
    if(tvWidget){ return; }
    const sym = symbolMap(document.getElementById('mPair').value);
    tvWidget = new TradingView.widget({
      autosize: true,
      symbol: sym,
      interval: "5",
      container_id: "tv",
      theme: "dark",
      style: "1",
      locale: "en",
      hide_top_toolbar: true,
      hide_legend: false,
      allow_symbol_change: false,
      withdateranges: false,
      calendar: false,
      studies: [],
    });
  }

  // timeframe buttons
  document.querySelector('#market .seg').addEventListener('click', (e)=>{
    const b = e.target.closest('button[data-tf]');
    if(!b||!tvWidget) return;
    [...e.currentTarget.children].forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    tvWidget.chart().setResolution(b.dataset.tf, ()=>{});
  });

  // pair change
  document.getElementById('mPair').addEventListener('change', (e)=>{
    if(!tvWidget) return;
    tvWidget.chart().setSymbol(symbolMap(e.target.value), ()=>{});
  });

  // ===== News (Discover) =====
  (function(){
    const NEWS = [
      {id:1, cat:'crypto',         title:'Bitcoin rebounds as funding stabilizes', sum:'BTC funding normalizes; traders eye next CPI prints.', time:'10 min ago', src:'Desk Wire'},
      {id:2, cat:'commodity:gold', title:'Gold edges higher on safe-haven demand', sum:'Dollar softens; bullion holds above key support.', time:'22 min ago', src:'Commodities Daily'},
      {id:3, cat:'commodity:crude',title:'Crude dips after inventory build',       sum:'API data shows larger‑than‑expected stockpile.', time:'35 min ago', src:'Energy Watch'},
      {id:4, cat:'forex',          title:'USD/JPY slips as yields cool',            sum:'Traders watch BOJ comments this week.', time:'1 hr ago', src:'FX Street Brief'},
      {id:5, cat:'indices',        title:'S&P futures flat before tech earnings',   sum:'Volatility remains subdued ahead of results.', time:'1 hr ago', src:'Index Desk'},
      {id:6, cat:'crypto',         title:'ETH gas fees ease on lower activity',     sum:'Layer‑2 volumes steady; stakers remain net positive.', time:'2 hr ago', src:'On‑Chain Note'}
    ];
    const listEl = document.getElementById('newsList');
    const filtersEl = document.getElementById('newsFilters');
    const btnRefresh = document.getElementById('newsRefresh');

    function tag(cat){
      if(cat.startsWith('commodity:')){
        const what = cat.split(':')[1];
        return `<span class="tag commodity">${what.toUpperCase()}</span>`;
      }
      const map = {crypto:'Crypto', forex:'Forex', indices:'Indices'};
      const label = map[cat]||cat;
      const cls = (cat==='crypto')?'crypto':(cat==='forex')?'commodity':'commodity';
      return `<span class="tag ${cls}">${label}</span>`;
    }
    function card(n){
      return `<article class="news-item">
        ${tag(n.cat)}
        <h3>${n.title}</h3>
        <p>${n.sum}</p>
        <div class="small right">${n.src} • ${n.time}</div>
      </article>`;
    }
    function render(cat='all'){
      const rows = NEWS.filter(n=>cat==='all' ? true : n.cat===cat);
      listEl.innerHTML = rows.length ? rows.map(card).join('') : `<div class="small">No stories.</div>`;
    }
    filtersEl.addEventListener('click', (e)=>{
      const b = e.target.closest('button[data-cat]'); if(!b) return;
      [...filtersEl.querySelectorAll('button')].forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      render(b.dataset.cat);
    });
    btnRefresh.addEventListener('click', ()=>{
      NEWS.sort(()=>Math.random()-0.5);
      const cat = filtersEl.querySelector('button.active')?.dataset.cat || 'all';
      render(cat);
      btnRefresh.disabled=true; setTimeout(()=>btnRefresh.disabled=false,500);
    });
    render('all');
  })();

  // ===== small helpers for Home (localStorage demo) =====
  (function(){
    const $ = id=>document.getElementById(id);
    ['riskPct','posUSDT','apiKey','apiSec'].forEach(k=>{
      const v = localStorage.getItem('jk_'+k) || '';
      if($(k)) $(k).value = v;
      $(k)?.addEventListener('input', e=>localStorage.setItem('jk_'+k, e.target.value));
    });
    $('pwShow')?.addEventListener('click', ()=>{
      const i = $('apiSec'); i.type = (i.type==='password'?'text':'password');
    });
    $('btnSaveKeys')?.addEventListener('click', ()=>{
      alert('Saved locally ✔');
    });
  })();
  </script>
</body>
</html>
