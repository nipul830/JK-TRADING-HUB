<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JK Trading Hub — Home</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- ===== NAVBAR (common) ===== -->
  <nav class="tabs">
    <a class="tab" href="index.html">Home</a>
    <a class="tab" href="market.html">Market</a>
    <a class="tab" href="trade.html">Trade</a>
    <a class="tab" href="discover.html">Discover</a>
    <a class="tab" href="account.html">My Account</a>
  </nav>
  <script>
    (function(){var f=location.pathname.split('/').pop()||'index.html';
      document.querySelectorAll('.tabs .tab').forEach(a=>{
        if(a.getAttribute('href')===f) a.classList.add('active');
      });
    })();
  </script>

  <!-- ===== ALGO SETUP ===== -->
  <section class="card section" id="algoBox">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
      <h3 style="margin:0">JK ALGO Setup</h3>
      <span id="algoStatus" class="badge mute">Stopped</span>
    </div>

    <div class="row">
      <label class="f">
        <span>Pair</span>
        <select id="pair" class="select">
          <option value="BTCUSDT">BTC/USDT</option>
          <option value="ETHUSDT">ETH/USDT</option>
          <option value="SOLUSDT">SOL/USDT</option>
          <option value="XRPUSDT">XRP/USDT</option>
        </select>
      </label>

      <label class="f">
        <span>Timeframe</span>
        <select id="tf" class="select">
          <option value="1m">1m</option>
          <option value="5m" selected>5m</option>
          <option value="15m">15m</option>
          <option value="1h">1h</option>
          <option value="4h">4h</option>
        </select>
      </label>
    </div>

    <div class="row" style="margin-top:10px">
      <label class="f">
        <span>Risk per Trade (%)</span>
        <input id="risk" type="number" step="0.1" min="0" class="input" placeholder="e.g. 1.0" />
      </label>
      <label class="f">
        <span>Position Size (USDT)</span>
        <input id="size" type="number" step="1" min="0" class="input" placeholder="e.g. 100" />
      </label>
    </div>

    <div style="display:flex;gap:10px;margin-top:12px">
      <button id="start" class="btn primary">Start</button>
      <button id="stop" class="btn warn">Stop</button>
      <div id="savedCfg" class="small" style="margin-left:6px"></div>
    </div>

    <div class="hr"></div>
    <div class="small">Frontend‑only UI. Settings <b>localStorage</b> me save hote hain. Real trading later plug karenge.</div>
  </section>

  <!-- ===== STRATEGY & INDICATORS ===== -->
  <section class="card section" id="stratBox">
    <h3>Strategy &amp; Indicators</h3>

    <div class="grid-3">
      <div class="f">
        <span>Pine‑like Strategy (paste code)</span>
        <textarea id="pine" class="input ta" spellcheck="false" placeholder="//@version=5
indicator('JK Demo', overlay=true)
emaFast = ta.ema(close, 9)
emaSlow = ta.ema(close, 21)
long  = ta.crossover(emaFast, emaSlow)
short = ta.crossunder(emaFast, emaSlow)"></textarea>
      </div>

      <div class="f">
        <span>Add Indicator (max 5)</span>
        <div class="row" style="grid-template-columns:1fr 1fr">
          <input id="indName" class="input" placeholder="e.g. EMA" />
          <input id="indArgs" class="input" placeholder="e.g. length=20" />
        </div>
        <button id="addInd" class="btn">Add</button>
        <ul id="indList" class="ind-list"></ul>
        <div class="small">Popular: EMA length=20, RSI length=14, MACD fast=12,slow=26,signal=9…</div>
      </div>

      <div class="f">
        <span>Actions</span>
        <button id="saveStrat" class="btn">Save Strategy</button>
        <button id="exportCfg" class="btn">Export JSON</button>
        <label class="f">
          <span class="small">Import JSON</span>
          <input id="importFile" type="file" accept="application/json" class="input" />
        </label>
        <div id="stratSaved" class="small"></div>
      </div>
    </div>
  </section>

  <!-- ===== API KEYS ===== -->
  <section class="card section" id="apiBox">
    <h3>API Keys</h3>

    <div class="api-row">
      <label class="f">
        <span>Exchange</span>
        <select id="exch" class="select">
          <option>Binance</option>
          <option>Bybit</option>
          <option>OKX</option>
        </select>
      </label>
      <div></div>
    </div>

    <div class="api-row" style="margin-top:8px">
      <label class="f">
        <span>API Key</span>
        <input id="apiKey" class="input" placeholder="xxxxxxxx" />
      </label>
      <label class="f">
        <span>API Secret</span>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="apiSec" class="input" type="password" placeholder="********" style="flex:1" />
          <span id="toggleSec" class="small" style="cursor:pointer">Show</span>
        </div>
      </label>
    </div>

    <div style="display:flex;gap:10px;margin-top:12px">
      <button id="saveApi" class="btn">Save Keys (local)</button>
      <div id="apiSaved" class="small" style="color:#8ff0b0"></div>
    </div>

    <div class="hr"></div>
    <div class="small">Security: Keys सिर्फ आपके browser के <b>localStorage</b> में रहते हैं; server को नहीं भेजे जाते. Public site पर असली keys न डालें.</div>
  </section>

  <!-- ===== Home Logic (localStorage only) ===== -->
  <script>
    const LS_CFG='jk_cfg', LS_STRAT='jk_strategy', LS_INDS='jk_indicators', LS_API='jk_api';
    const $=id=>document.getElementById(id);

    // --- ALGO SETUP ---
    const pair=$('pair'), tf=$('tf'), risk=$('risk'), size=$('size'), statusEl=$('algoStatus'), savedCfg=$('savedCfg');
    let cfg = JSON.parse(localStorage.getItem(LS_CFG)||'{}');
    cfg = Object.assign({running:false,pair:'BTCUSDT',tf:'5m',risk:'',size:''}, cfg);
    function renderCfg(){ pair.value=cfg.pair; tf.value=cfg.tf; risk.value=cfg.risk||''; size.value=cfg.size||''; statusEl.textContent=cfg.running?'Running':'Stopped'; statusEl.className='badge '+(cfg.running?'ok':'mute'); }
    function saveCfg(){ localStorage.setItem(LS_CFG, JSON.stringify(cfg)); savedCfg.textContent='Saved'; setTimeout(()=>savedCfg.textContent='',1000); }
    renderCfg();
    pair.onchange=()=>{cfg.pair=pair.value; saveCfg();};
    tf.onchange  =()=>{cfg.tf=tf.value; saveCfg();};
    risk.oninput=()=>{cfg.risk=risk.value; saveCfg();};
    size.oninput=()=>{cfg.size=size.value; saveCfg();};
    $('start').onclick=()=>{cfg.running=true; saveCfg(); renderCfg();};
    $('stop').onclick =()=>{cfg.running=false; saveCfg(); renderCfg();};

    // --- STRATEGY & INDICATORS ---
    const pine=$('pine'), indName=$('indName'), indArgs=$('indArgs'), indList=$('indList');
    pine.value = localStorage.getItem(LS_STRAT)||'';
    function loadInds(){ return JSON.parse(localStorage.getItem(LS_INDS)||'[]'); }
    function saveInds(arr){ localStorage.setItem(LS_INDS, JSON.stringify(arr)); }
    function renderInds(){
      const L=loadInds(); indList.innerHTML='';
      L.forEach((it,i)=>{ const li=document.createElement('li'); li.className='ind-item';
        li.innerHTML=`<div><b>${it.name}</b> <span class="small">${it.args||''}</span></div><button class="btn warn" data-i="${i}">Remove</button>`;
        indList.appendChild(li);
      });
      indList.querySelectorAll('button').forEach(b=>b.onclick=()=>{const i=+b.dataset.i; const L=loadInds(); L.splice(i,1); saveInds(L); renderInds();});
    }
    renderInds();
    $('addInd').onclick=()=>{ const name=indName.value.trim(); if(!name) return; const args=indArgs.value.trim(); const L=loadInds(); if(L.length>=5){alert('Max 5 indicators');return;} L.push({name, args}); saveInds(L); renderInds(); indName.value=''; indArgs.value=''; };
    $('saveStrat').onclick=()=>{ localStorage.setItem(LS_STRAT, pine.value); $('stratSaved').textContent='Strategy saved'; setTimeout(()=>$('stratSaved').textContent='',1000); };

    // Export/Import
    $('exportCfg').onclick=()=>{
      const data={cfg, strategy: pine.value, indicators: loadInds(), api: JSON.parse(localStorage.getItem(LS_API)||'{}')};
      const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob);
      const a=document.createElement('a'); a.href=url; a.download='jk-export.json'; a.click(); URL.revokeObjectURL(url);
    };
    $('importFile').onchange=(e)=>{
      const f=e.target.files[0]; if(!f) return; const rd=new FileReader();
      rd.onload=()=>{ try{ const obj=JSON.parse(rd.result);
        if(obj.cfg){cfg=obj.cfg; saveCfg(); renderCfg();}
        if('strategy' in obj){ pine.value=obj.strategy||''; localStorage.setItem(LS_STRAT, pine.value); }
        if(Array.isArray(obj.indicators)){ localStorage.setItem(LS_INDS, JSON.stringify(obj.indicators)); renderInds(); }
        if(obj.api){ localStorage.setItem(LS_API, JSON.stringify(obj.api)); renderApi(); }
        alert('Import OK');
      }catch(_){ alert('Invalid JSON'); } };
      rd.readAsText(f);
    };

    // --- API KEYS (local only) ---
    const exch=$('exch'), apiKey=$('apiKey'), apiSec=$('apiSec');
    function loadApi(){ return JSON.parse(localStorage.getItem(LS_API)||'{"exch":"Binance","apiKey":"","apiSec":""}'); }
    function saveApi(a){ localStorage.setItem(LS_API, JSON.stringify(a)); }
    function renderApi(){ const a=loadApi(); exch.value=a.exch; apiKey.value=a.apiKey||''; apiSec.value=a.apiSec||''; $('apiSaved').textContent='Saved'; setTimeout(()=>$('apiSaved').textContent='',1000);}
    renderApi();
    $('saveApi').onclick=()=>{ saveApi({exch:exch.value, apiKey:apiKey.value, apiSec:apiSec.value}); renderApi(); };
    $('toggleSec').onclick=()=>{ apiSec.type = apiSec.type==='password' ? 'text':'password'; $('toggleSec').textContent = apiSec.type==='password' ? 'Show':'Hide'; };
  </script>
</body>
</html>
