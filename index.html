<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>JK Trading Hub – Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Navbar -->
  <div class="tabs">
    <a class="tab active" href="index.html">Home</a>
    <a class="tab" href="market.html">Market</a>
    <a class="tab" href="trade.html">Trade</a>
    <a class="tab" href="discover.html">Discover</a>
    <a class="tab" href="account.html">Account</a>
  </div>

  <!-- ================= ALGO SETUP ================= -->
  <section class="card section" id="algoBox">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
      <h3 style="margin:0">JK ALGO Setup</h3>
      <span id="algoStatus" class="badge mute">Stopped</span>
    </div>

    <div class="row">
      <label class="f">
        <span>Pair</span>
        <select id="pair" class="select">
          <option value="BTCUSDT">BTC/USDT</option>
          <option value="ETHUSDT">ETH/USDT</option>
          <option value="SOLUSDT">SOL/USDT</option>
          <option value="XRPUSDT">XRP/USDT</option>
        </select>
      </label>

      <label class="f">
        <span>Timeframe</span>
        <select id="tf" class="select">
          <option value="1m">1m</option>
          <option value="5m" selected>5m</option>
          <option value="15m">15m</option>
          <option value="1h">1h</option>
          <option value="4h">4h</option>
        </select>
      </label>
    </div>

    <div class="row" style="margin-top:10px">
      <label class="f">
        <span>Risk per Trade (%)</span>
        <input id="risk" type="number" step="0.1" min="0" class="input" placeholder="e.g. 1.0" />
      </label>
      <label class="f">
        <span>Position Size (USDT)</span>
        <input id="size" type="number" step="1" min="0" class="input" placeholder="e.g. 100" />
      </label>
    </div>

    <div style="display:flex;gap:10px;margin-top:12px">
      <button id="start" class="btn primary">Start</button>
      <button id="stop" class="btn warn">Stop</button>
      <div id="savedCfg" class="small" style="margin-left:6px"></div>
    </div>

    <div class="hr"></div>
    <div class="small">Note: Ye UI frontend-only है; koi order execute नहीं karta. Start/Stop & settings <b>localStorage</b> में save होते हैं.</div>
  </section>

  <!-- ================= STRATEGY & INDICATORS ================= -->
  <section class="card section" id="stratBox">
    <h3 style="margin:0 0 10px">Strategy &amp; Indicators</h3>

    <div class="grid-3">
      <div class="f">
        <span>Pine-like Strategy (paste code)</span>
        <textarea id="pine" class="input ta" spellcheck="false" placeholder="//@version=5
indicator('JK Demo', overlay=true)
emaFast = ta.ema(close, 9)
emaSlow = ta.ema(close, 21)
long  = ta.crossover(emaFast, emaSlow)
short = ta.crossunder(emaFast, emaSlow)"></textarea>
      </div>

      <div class="f">
        <span>Add Indicator (max 5)</span>
        <div class="row" style="grid-template-columns:1fr 1fr">
          <input id="indName" class="input" placeholder="e.g. EMA" />
          <input id="indArgs" class="input" placeholder="e.g. length=20" />
        </div>
        <button id="addInd" class="btn">Add</button>
        <ul id="indList" class="ind-list"></ul>
        <div class="small">Popular: EMA length=20, RSI length=14, MACD fast=12,slow=26,signal=9…</div>
      </div>

      <div class="f">
        <span>Quick Actions</span>
        <button id="saveStrat" class="btn">Save Strategy</button>
        <button id="exportCfg" class="btn">Export JSON</button>
        <label class="f">
          <span class="small">Import JSON</span>
          <input id="importFile" type="file" accept="application/json" class="input" />
        </label>
        <div id="stratSaved" class="small"></div>
      </div>
    </div>
  </section>

  <!-- ================= API KEYS ================= -->
  <section class="card section" id="apiBox">
    <h3 style="margin:0 0 10px">API Keys</h3>

    <div class="api-row">
      <label class="f">
        <span>Exchange</span>
        <select id="exch" class="select">
          <option>Binance</option>
          <option>Bybit</option>
          <option>OKX</option>
        </select>
      </label>
      <div></div>
    </div>

    <div class="api-row" style="margin-top:8px">
      <label class="f">
        <span>API Key</span>
        <input id="apiKey" class="input" placeholder="xxxxxxxx" />
      </label>
      <label class="f">
        <span>API Secret</span>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="apiSec" class="input" type="password" placeholder="********" style="flex:1" />
          <span id="toggleSec" class="reveal">Show</span>
        </div>
      </label>
    </div>

    <div style="display:flex;gap:10px;margin-top:12px">
      <button id="saveApi" class="btn">Save Keys (local)</button>
      <div id="apiSaved" class="saved"></div>
    </div>

    <div class="hr"></div>
    <div class="small">Security: Keys सिर्फ आपके browser के <b>localStorage</b> में रहते हैं; server को नहीं भेजे जाते. Public site पर असली keys use न करें.</div>
  </section>

  <script>
    // ===== LocalStorage helpers =====
    const LS_CFG   = 'jk_cfg';
    const LS_STRAT = 'jk_strategy';
    const LS_INDS  = 'jk_indicators';
    const LS_API   = 'jk_api';

    const $ = id => document.getElementById(id);

    // ===== ALGO SETUP =====
    const pair=$('pair'), tf=$('tf'), risk=$('risk'), size=$('size');
    const statusEl=$('algoStatus'), savedCfg=$('savedCfg');

    function loadCfg(){
      const raw = localStorage.getItem(LS_CFG);
      return raw ? JSON.parse(raw) : {running:false,pair:'BTCUSDT',tf:'5m',risk:'',size:''};
    }
    function saveCfg(cfg){ localStorage.setItem(LS_CFG, JSON.stringify(cfg)); }
    function renderCfg(cfg){
      pair.value=cfg.pair; tf.value=cfg.tf; risk.value=cfg.risk||''; size.value=cfg.size||'';
      if(cfg.running){ statusEl.textContent='Running'; statusEl.className='badge ok'; }
      else{ statusEl.textContent='Stopped'; statusEl.className='badge mute'; }
      savedCfg.textContent='Saved';
      setTimeout(()=>savedCfg.textContent='',1200);
    }
    let cfg = loadCfg(); renderCfg(cfg);

    pair.onchange=()=>{ cfg.pair=pair.value; saveCfg(cfg); };
    tf.onchange  =()=>{ cfg.tf=tf.value;     saveCfg(cfg); };
    risk.oninput=()=>{ cfg.risk=risk.value;  saveCfg(cfg); };
    size.oninput=()=>{ cfg.size=size.value;  saveCfg(cfg); };

    $('start').onclick=()=>{ cfg.running=true; saveCfg(cfg); renderCfg(cfg); };
    $('stop').onclick =()=>{ cfg.running=false; saveCfg(cfg); renderCfg(cfg); };

    // ===== STRATEGY & INDICATORS =====
    const pine=$('pine'), indName=$('indName'), indArgs=$('indArgs'), indList=$('indList');

    function loadStrat(){ return localStorage.getItem(LS_STRAT) || ''; }
    function saveStrat(data){ localStorage.setItem(LS_STRAT, data); }
    function loadInds(){ const r=localStorage.getItem(LS_INDS); return r?JSON.parse(r):[]; }
    function saveInds(list){ localStorage.setItem(LS_INDS, JSON.stringify(list)); }
    function renderInds(){
      const list = loadInds();
      indList.innerHTML='';
      list.forEach((it,idx)=>{
        const li=document.createElement('li'); li.className='ind-item';
        li.innerHTML=`<div><b>${it.name}</b> <span class="small">${it.args||''}</span></div>
                      <button class="btn warn" data-i="${idx}">Remove</button>`;
        indList.appendChild(li);
      });
      // bind remove
      indList.querySelectorAll('button').forEach(b=>{
        b.onclick=()=>{ const i=+b.dataset.i; const L=loadInds(); L.splice(i,1); saveInds(L); renderInds(); };
      });
    }

    pine.value = loadStrat();
    renderInds();

    $('addInd').onclick=()=>{
      const name = indName.value.trim();
      if(!name) return;
      const args = indArgs.value.trim();
      const list = loadInds();
      if(list.length>=5){ alert('Max 5 indicators'); return; }
      list.push({name, args});
      saveInds(list); renderInds();
      indName.value=''; indArgs.value='';
    };

    $('saveStrat').onclick=()=>{
      saveStrat(pine.value);
      $('stratSaved').textContent='Strategy saved';
      setTimeout(()=>{$('stratSaved').textContent='';},1200);
    };

    // Export / Import JSON (cfg + strategy + indicators)
    $('exportCfg').onclick=()=>{
      const blob = new Blob([JSON.stringify({
        cfg: loadCfg(),
        strategy: loadStrat(),
        indicators: loadInds(),
        api: loadApi()
      }, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href=url; a.download='jk-export.json'; a.click(); URL.revokeObjectURL(url);
    };
    $('importFile').onchange=(e)=>{
      const f=e.target.files[0]; if(!f) return;
      const r=new FileReader();
      r.onload=()=>{
        try{
          const obj=JSON.parse(r.result);
          if(obj.cfg){ cfg=obj.cfg; saveCfg(cfg); renderCfg(cfg); }
          if(typeof obj.strategy==='string'){ pine.value=obj.strategy; saveStrat(obj.strategy); }
          if(Array.isArray(obj.indicators)){ saveInds(obj.indicators); renderInds(); }
          if(obj.api){ saveApi(obj.api); renderApi(); }
          alert('Import OK');
        }catch(err){ alert('Invalid JSON'); }
      };
      r.readAsText(f);
    };

    // ===== API KEYS (local only) =====
    const exch=$('exch'), apiKey=$('apiKey'), apiSec=$('apiSec'), apiSaved=$('apiSaved');

    function loadApi(){ const r=localStorage.getItem(LS_API); return r?JSON.parse(r):{exch:'Binance',apiKey:'',apiSec:''}; }
    function saveApi(a){ localStorage.setItem(LS_API, JSON.stringify(a)); }
    function renderApi(){
      const a=loadApi();
      exch.value=a.exch; apiKey.value=a.apiKey||''; apiSec.value=a.apiSec||'';
      apiSaved.textContent='Saved';
      setTimeout(()=>apiSaved.textContent='',1200);
    }
    renderApi();

    $('saveApi').onclick=()=>{
      saveApi({exch:exch.value, apiKey:apiKey.value, apiSec:apiSec.value});
      renderApi();
    };
    $('toggleSec').onclick=()=>{
      apiSec.type = apiSec.type==='password' ? 'text' : 'password';
      $('toggleSec').textContent = apiSec.type==='password' ? 'Show' : 'Hide';
    };
  </script>
</body>
</html>
